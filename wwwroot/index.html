<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerenciador de Dispositivos</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        h2 { margin-top: 40px; }
        input, button { padding: 8px; margin: 5px; }
        table { margin-top: 15px; border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #eee; }
        .card { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    </style>
</head>
<body>

    <h1>CRUD de Dispositivos</h1>

    <!-- LISTAR -->
    <div class="card">
        <h2>Listar Dispositivos</h2>
        <button onclick="listar()">Atualizar Lista</button>
        <table id="tabela">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Fabricante</th>
                    <th>Empresa</th>
                    <th>Local</th>
                    <th>Tipo</th>
                    <th>Ativo</th>
                    <th>Lucro</th>
                    <th>Custo Operação</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- CRIAR -->
    <div class="card">
        <h2>Criar Dispositivo</h2>
        <form onsubmit="criar(event)">
            <input id="cFabricante" placeholder="Fabricante" required>
            <input id="cEmpresa" placeholder="Empresa" required>
            <input id="cLocal" placeholder="Local" required>
            <input id="cTipo" placeholder="Tipo" required>
            <label><input id="cAtivo" type="checkbox"> Ativo?</label>
            <input id="cLucro" type="number" placeholder="Lucro" required>
            <input id="cCusto" type="number" placeholder="Custo Operação" required>
            <button type="submit">Criar</button>
        </form>
    </div>

    <!-- ATUALIZAR -->
    <div class="card">
        <h2>Atualizar Dispositivo</h2>
        <form onsubmit="atualizar(event)">
            <input id="uId" placeholder="ID" required>

            <input id="uFabricante" placeholder="Fabricante">
            <input id="uEmpresa" placeholder="Empresa">
            <input id="uLocal" placeholder="Local">
            <input id="uTipo" placeholder="Tipo">

            <label><input id="uAtivo" type="checkbox"> Ativo?</label>
            <input id="uLucro" type="number" placeholder="Lucro">
            <input id="uCusto" type="number" placeholder="Custo Operação">

            <button type="submit">Atualizar</button>
        </form>
    </div>

    <!-- DELETAR -->
    <div class="card">
        <h2>Deletar Dispositivo</h2>
        <form onsubmit="deletar(event)">
            <input id="dId" placeholder="ID do dispositivo" required>
            <button type="submit">Deletar</button>
        </form>
    </div>

<script>
// ===================== LISTAR =====================
async function listar() {
    const tabela = document.querySelector("#tabela tbody");
    tabela.innerHTML = "";

    const resp = await fetch("/dispositivos");
    const dados = await resp.json();

    dados.forEach(d => {
        tabela.innerHTML += `
            <tr>
                <td>${d.id}</td>
                <td>${d.fabricante}</td>
                <td>${d.empresa}</td>
                <td>${d.local}</td>
                <td>${d.tipo}</td>
                <td>${d.ativo}</td>
                <td>${d.lucro}</td>
                <td>${d.custoDeOperacao}</td>
            </tr>
        `;
    });
}

// ===================== CRIAR =====================
async function criar(e) {
    e.preventDefault();

    const novo = {
        fabricante: cFabricante.value,
        empresa: cEmpresa.value,
        local: cLocal.value,
        tipo: cTipo.value,
        ativo: cAtivo.checked,
        lucro: Number(cLucro.value),
        custoDeOperacao: Number(cCusto.value)
    };

    await fetch("/dispositivos", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(novo)
    });

    alert("Criado com sucesso!");
    listar();
}

// ===================== ATUALIZAR =====================
async function atualizar(e) {
    e.preventDefault();

    const id = uId.value;
    const atualizado = {
        fabricante: uFabricante.value,
        empresa: uEmpresa.value,
        local: uLocal.value,
        tipo: uTipo.value,
        ativo: uAtivo.checked,
        lucro: Number(uLucro.value),
        custoDeOperacao: Number(uCusto.value)
    };

    const resp = await fetch(`/dispositivos/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(atualizado)
    });

    if (resp.ok) alert("Atualizado com sucesso!");
    else alert("ID não encontrado!");

    listar();
}

// ===================== DELETAR =====================
async function deletar(e) {
    e.preventDefault();

    const id = dId.value;

    const resp = await fetch(`/dispositivos/${id}`, {
        method: "DELETE"
    });

    if (resp.status === 204) alert("Deletado!");
    else alert("ID não encontrado!");

    listar();
}

listar(); // carregar automaticamente
</script>

</body>
</html>

